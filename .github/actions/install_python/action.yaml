name: "Install python ecosystem"
inputs:
  python-version:
    description: "The version of Python to install"
    required: true
    default: "3.12"
runs:
  using: "composite"
  steps:

  - name: "Set up environment variables"
    shell: "bash"
    run: |
      echo "PYTHON=python${{ inputs.python-version }}" >> $GITHUB_ENV

  - name: "Create tools directory and add it to PATH"
    shell: "bash"
    run: |
      if [ ! -d .tools ] ; then mkdir .tools ; fi
      if [ ! -d .tools/bin ] ; then mkdir .tools/bin ; fi
      echo "PATH=${{ github.workspace }}/.tools/bin:$PATH" >> $GITHUB_ENV

  - name: "Set up Python ${{ inputs.python-version }}"
    uses: "actions/setup-python@v5"
    with:
      python-version: "${{ inputs.python-version }}"

  - name: "Install UV resolver"
    shell: "bash"
    run: |
      if [ ! -d .tools ] ; then mkdir .tools ; fi
      ${PYTHON} -m venv .tools/uv
      .tools/uv/bin/pip install -U uv
      
      ln -s ${{ github.workspace }}/.tools/uv/bin/uv ${{ github.workspace }}/.tools/bin/uv 

      uv --version

  - name: Set up Node20
    uses: actions/setup-node@v4
    with:
      node-version: 20

  - name: "Install invenio-cli"
    shell: "bash"
    run: |
      uv venv .tools/invenio-cli
      source .tools/invenio-cli/bin/activate
      uv pip install -U invenio-cli

      ln -s ${{ github.workspace }}/.tools/invenio-cli/bin/invenio-cli ${{ github.workspace }}/.tools/bin/invenio-cli 

      invenio-cli --version
      invenio-cli check-requirements
      

  - name: "Install pipenv"
    shell: "bash"
    run: |
      uv venv .tools/pipenv
      source .tools/pipenv/bin/activate
      uv pip install -U pipenv

      ln -s ${{ github.workspace }}/.tools/pipenv/bin/pipenv ${{ github.workspace }}/.tools/bin/pipenv 

      pipenv --version
